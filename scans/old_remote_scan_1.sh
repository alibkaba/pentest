#!/bin/bash
################################################################################
## [Author]:
## Ali Kaba www.alibkaba.com
##------------------------------------------------------------------------------
## [Warning]:
## This tool may be used for legal purposes only.  Users take full
## responsibility for any actions performed using this tool.  The author accepts
## no liability for damage caused by this tool.  If you do not accept these
## condition then you are prohibited from using this tool.
##
## This script comes as-is with no promise of functionality or accuracy.
## Ensure that you have the appropriate legal permission before running it
## someone else's system.
##------------------------------------------------------------------------------
## [MIT License]:
##
## Copyright (c) [2017] [Ali Kaba]
##
## Permission is hereby granted, free of charge, to any person obtaining a copy
## of this software and associated documentation files (the "Software"), to deal
## in the Software without restriction, including without limitation the rights
## to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
## copies of the Software, and to permit persons to whom the Software is
## furnished to do so, subject to the following conditions:
##
## The above copyright notice and this permission notice shall be included in
## all copies or substantial portions of the Software.
##
## THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
## IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
## FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
## AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
## LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
## OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
## SOFTWARE.
################################################################################

# fingerprint top 1k tcp ports
light_tcp(){
	echo nmap -A -T4 -F --open $ipADDRESS > $dirNAME/top_1k_tcp_ports_WORKING.txt
	nmap -A -T4 -F --open $ipADDRESS >> $dirNAME/top_1k_tcp_ports_WORKING.txt
	mv $dirNAME/top_1k_tcp_ports_WORKING.txt $dirNAME/top_1k_tcp_ports.txt
	light_udp &
	exit 0
}

# fingerprint top 1k udp ports
light_udp(){
	echo nmap -A -sU -T4 -F --open $ipADDRESS > $dirNAME/top_1k_udp_ports_WORKING.txt
	nmap -A -sU -T4 -F --open $ipADDRESS >> $dirNAME/top_1k_udp_ports_WORKING.txt
	mv $dirNAME/top_1k_udp_ports_WORKING.txt $dirNAME/top_1k_udp_ports.txt
	all_tcp_ports &
	exit 0
}

# fingerprint all tcp ports
all_tcp_ports(){
	echo nmap -A -p- -T4 --reason $ipADDRESS > $dirNAME/tcp_WORKING.txt
	nmap -A -p- -T4 --reason $ipADDRESS >> $dirNAME/tcp_WORKING.txt
	mv $dirNAME/tcp_WORKING.txt $dirNAME/tcp.txt
	all_udp_ports &
	exit 0
}

# fingerprint all udp ports
all_udp_ports(){
	echo nmap -T4 -sU --reason $ipADDRESS > $dirNAME/udp_WORKING.txt
	nmap -T4 -sU --reason $ipADDRESS >> $dirNAME/udp_WORKING.txt
	mv $dirNAME/udp_WORKING.txt $dirNAME/udp.txt
	exit 0
}

# nmap scans
ipADDRESS=$1
dirNAME="/root/"
dirNAME+=$2
if [[ -z "$ipADDRESS" ]] && [[ -z "$dirNAME" ]] || [[ ! -z "$3" ]]
then
	echo "[*] Scan script"
	echo "[*] Usage : $0 <ipaddress> <directoryname> "
	exit 0
fi

if [[ ! -d $dirNAME ]]
then
	mkdir $dirNAME
fi

light_tcp &
