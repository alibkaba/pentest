#!/bin/bash
################################################################################
## [Author]:
## Ali Kaba www.alibkaba.com
##------------------------------------------------------------------------------
## [Warning]:
## This tool may be used for legal purposes only.  Users take full
## responsibility for any actions performed using this tool.  The author accepts
## no liability for damage caused by this tool.  If you do not accept these
## condition then you are prohibited from using this tool.
##
## This script comes as-is with no promise of functionality or accuracy.
## Ensure that you have the appropriate legal permission before running it
## someone else's system.
##------------------------------------------------------------------------------
## [MIT License]:
##
## Copyright (c) [2017] [Ali Kaba]
##
## Permission is hereby granted, free of charge, to any person obtaining a copy
## of this software and associated documentation files (the "Software"), to deal
## in the Software without restriction, including without limitation the rights
## to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
## copies of the Software, and to permit persons to whom the Software is
## furnished to do so, subject to the following conditions:
##
## The above copyright notice and this permission notice shall be included in
## all copies or substantial portions of the Software.
##
## THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
## IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
## FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
## AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
## LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
## OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
## SOFTWARE.
################################################################################

# fingerprint top 1k tcp ports
lightTCP(){
	nmap -Pn -n -A -T4 -F --open $ipADDRESS > $ipADDRESS/lightTCP_WORKING.txt
	mv $ipADDRESS/lightTCP_WORKING.txt $ipADDRESS/lightTCP.txt
	heavyTCP &
}

# fingerprint all tcp ports
heavyTCP(){
	nmap -Pn -n -T4 -A -v -p- --reason $ipADDRESS > $ipADDRESS/heavyTCP_WORKING.txt
	mv $ipADDRESS/heavyTCP_WORKING.txt $ipADDRESS/heavyTCP.txt
	lightUDP &
}

# fingerprint top 1k udp ports
lightUDP(){
	nmap -Pn -n -A -sU -T4 -F --open $ipADDRESS > $ipADDRESS/lightUDP_WORKING.txt
	mv $ipADDRESS/lightUDP_WORKING.txt $ipADDRESS/lightUDP.txt
	heavyUDP &
}

# fingerprint all udp ports
heavyUDP(){
	nmap -Pn -n -T4 -A -v -p- -sU --reason $ipADDRESS > $ipADDRESS/heavyUDP_WORKING.txt
	mv $ipADDRESS/heavyUDP_WORKING.txt $ipADDRESS/heavyUDP.txt
}

httpENUM(){
	httpPORT=$(grep http $ipADDRESS/lightTCP.txt | grep tcp | awk -F'/' '{print $1}');
	if [ ! -z "$httpPORT" ]; then
		nikto -h $ipADDRESS:$httpPORT > $ipADDRESS/nikto.txt &
		dirb http://$ipADDRESS:$httpPORT $DIRB_BIG -o $ipADDRESS/dirb.txt &
		gobuster -u http://$ipADDRESS:$httpPORT -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e > $ipADDRESS/gobuster.txt &
		gobuster -u http://$ipADDRESS:$httpPORT -w /usr/share/seclists/Discovery/Web_Content/cgis.txt -s '200,204,301,302,307,403,500' -e > $ipADDRESS/gobustercgis.txt &
	fi

	# http://10.11.1.251/wp/ wp-includes
}

snmpENUM(){
	snmpPORT=$(grep http $ipADDRESS/lightUDP.txt | grep tcp | awk -F'/' '{print $1}');
	if [ ! -z "$snmpPORT" ]; then
		enum4linux $ipADDRESS > $ipADDRESS/enum4linux.txt &
	fi
}

dnsENUMtcp(){
	snmpPORT=$(grep http $ipADDRESS/lightTCP.txt | grep tcp | awk -F'/' '{print $1}');
	if [ ! -z "$snmpPORT" ]; then
		dnsrecon -d $ipADDRESS -t axfr > $ipADDRESS/dnsrecontcp.txt &
	fi
}

dnsENUMudp(){
	snmpPORT=$(grep http $ipADDRESS/lightUDP.txt | grep tcp | awk -F'/' '{print $1}');
	if [ ! -z "$snmpPORT" ]; then
		dnsrecon -d $ipADDRESS -t axfr > $ipADDRESS/dnsreconudp.txt &
	fi
}

# nmap scans
ipADDRESS=$1
if [[ -z "$ipADDRESS" ]] || [[ ! -z "$2" ]]; then
	echo "[*] Scan script"
	echo "[*] Usage : $0 <target ip> "
	exit 0
fi

# check to see if directory exists
if [[ ! -d "~/$ipADDRESS" ]]; then
	mkdir $ipADDRESS/
fi

# Wordlists
# Usernames
USERS_SHORT="/usr/share/seclists/Usernames/top_shortlist.txt";

# Common Roots
COMMON_ROOTS="/usr/share/wordlists/metasploit/common_roots.txt";

# Default Users
DEFAULT_USERS="/usr/share/wordlists/metasploit/default_users_for_services_unhash.txt";

# Big Userlist
BIG_USERLIST="/usr/share/wordlists/metasploit/namelist.lst";

# Passwords
PASSWORDS_top="/usr/share/seclists/Passwords/10_million_password_list_top_500.txt";
PASSWORDS_worst="/usr/share/seclists/Passwords/500-worst-passwords.txt";
PASSWORDS_rock="/usr/share/wordlists/rockyou.txt";
PASSWORDS_win="/usr/share/seclists/Passwords/common-passwords-win.txt";

# Directories
WEB_ROBOTS_DISALLOWED="/usr/share/seclists/Discovery/WebContent/Top1000-RobotsDisallowed.txt";
WEB_BIG="/usr/share/seclists/Discovery/WebContent/big.txt";
DIRB_BIG="/usr/share/wordlists/dirb/big.txt";

lightTCP &
